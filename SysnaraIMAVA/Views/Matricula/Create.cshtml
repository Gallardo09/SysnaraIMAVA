@model SystemSysnara.Models.Matricula

@{
    ViewData["Title"] = "Crear Matricula";
}

<h2 class="text-center mb-4" style="font-family: 'Russo One', sans-serif;">Matricular Estudiante</h2>

<div class="container">
    <form asp-action="Create" enctype="multipart/form-data">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Datos del Padre o Encargado</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="form-group col-md-3">
                        <label asp-for="Idpadre" class="control-label">Identidad del Padre</label>
                        <input asp-for="Idpadre" class="form-control" id="Idpadre" />
                        <span asp-validation-for="Idpadre" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-3">
                        <label asp-for="NombrePadre" class="control-label">Nombre del Padre</label>
                        <input asp-for="NombrePadre" class="form-control" id="NombrePadre" readonly />
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="Parentesco" class="control-label">Parentesco</label>
                        <input asp-for="Parentesco" class="form-control" id="Parentesco" readonly />
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="TelefonoPadre" class="control-label">Teléfono</label>
                        <input asp-for="TelefonoPadre" class="form-control" id="TelefonoPadre" readonly />
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="CelPadre" class="control-label">Celular</label>
                        <input asp-for="CelPadre" class="form-control" id="CelPadre" readonly />
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="form-group col-md-12">
                        <label asp-for="DireccionPadre" class="control-label">Dirección del Padre</label>
                        <input asp-for="DireccionPadre" class="form-control" id="DireccionPadre" readonly />
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">Datos del Estudiante</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="form-group col-md-2">
                        <label asp-for="Idaño" class="control-label">Año</label>
                        <select asp-for="Idaño" id="Idaño" class="form-control" asp-items="ViewBag.Idaño"></select>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="Ididentidad" class="control-label">Identidad</label>
                        <input asp-for="Ididentidad" class="form-control" id="Ididentidad" onkeydown="buscarEstudiante(event)" />
                        <span asp-validation-for="Ididentidad" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-4">
                        <label asp-for="NombreEstudiante" class="control-label">Nombre del Estudiante</label>
                        <input asp-for="NombreEstudiante" id="NombreEstudiante" class="form-control" />
                        <span asp-validation-for="NombreEstudiante" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="Nacionalidad" class="control-label">Nacionalidad</label>
                        <select asp-for="Nacionalidad" class="form-control">
                            <option value="HONDUREÑO(A)">HONDUREÑO(A)</option>
                            <option value="EXTRANJERO(A)">EXTRANJERO(A)</option>
                        </select>
                        <span asp-validation-for="Nacionalidad" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="FechaNacimiento" class="control-label">Fecha de Nacimiento</label>
                        <input type="date" asp-for="FechaNacimiento" id="FechaNacimiento" class="form-control" />
                        <span asp-validation-for="FechaNacimiento" class="text-danger"></span>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="form-group col-md-3">
                        <label asp-for="LugarNacimiento" class="control-label">Lugar de Nacimiento</label>
                        <input asp-for="LugarNacimiento" class="form-control" />
                        <span asp-validation-for="LugarNacimiento" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="Genero" class="control-label">Género</label>
                        <select asp-for="Genero" class="form-control">
                            <option value=""></option>
                            <option value="FEMENINO">FEMENINO</option>
                            <option value="MASCULINO">MASCULINO</option>
                        </select>
                        <span asp-validation-for="Genero" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="TipoSangre" class="control-label">Tipo Sangre</label>
                        <select asp-for="TipoSangre" class="form-control">
                            <option value=""></option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                        <span asp-validation-for="TipoSangre" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="Alergia" class="control-label">Alergias</label>
                        <select asp-for="Alergia" class="form-control">
                            <option value="NO">NO</option>
                            <option value="SI">SI</option>
                        </select>
                        <span asp-validation-for="Alergia" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-1">
                        <label asp-for="Edad" class="control-label">Edad</label>
                        <input type="number" asp-for="Edad" id="Edad" readonly class="form-control" />
                        <span asp-validation-for="Edad" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="TelefonoEstudiante" class="control-label">Teléfono</label>
                        <input asp-for="TelefonoEstudiante" class="form-control" placeholder="(+504)2525-2525" />
                        <span asp-validation-for="TelefonoEstudiante" class="text-danger"></span>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="form-group col-md-2">
                        <label asp-for="CelularEstudiante" class="control-label">Celular</label>
                        <input asp-for="CelularEstudiante" class="form-control" placeholder="(+504)9999-9999"/>
                        <span asp-validation-for="CelularEstudiante" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-3">
                        <label asp-for="Correo" class="control-label">Correo</label>
                        <input type="email" asp-for="Correo" class="form-control" />
                        <span asp-validation-for="Correo" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-5">
                        <label asp-for="Direccion" class="control-label">Dirección del Estudiante</label>
                        <input asp-for="Direccion" class="form-control" />
                        <span asp-validation-for="Direccion" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="Estado" class="control-label">Estado</label>
                        <select asp-for="Estado" class="form-control">
                            <option value=""></option>
                            <option value="ACTIVO">ACTIVO</option>
                            <option value="INACTIVO">INACTIVO</option>
                        </select>
                        <span asp-validation-for="Estado" class="text-danger"></span>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="form-group col-md-2">
                        <label asp-for="VacunasCovid" class="control-label">Vacunas Covid</label>
                        <input type="number" asp-for="VacunasCovid" class="form-control" />
                        <span asp-validation-for="VacunasCovid" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Información Académica</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="form-group col-md-2">
                        <label asp-for="Idgrado" class="control-label">ID Grado</label>
                        <select asp-for="Idgrado" id="Idgrado" class="form-control">
                            <option value="">Seleccione un grado</option>
                        </select>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="Grado" class="control-label">Grado</label>
                        <input asp-for="Grado" class="form-control" id="Grado" readonly />
                        <span asp-validation-for="Grado" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-1">
                        <label asp-for="Seccion" class="control-label">Sección</label>
                        <input asp-for="Seccion" class="form-control" id="Seccion" readonly/>
                        <span asp-validation-for="Seccion" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="Jornada" class="control-label">Jornada</label>
                        <input asp-for="Jornada" class="form-control" id="Jornada" readonly />
                        <span asp-validation-for="Jornada" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-5">
                        <label asp-for="NivelDescripcion" class="control-label">Nivel Académico Escolar</label>
                        <input asp-for="NivelDescripcion" class="form-control" id="NivelDescripcion" readonly />
                        <span asp-validation-for="NivelDescripcion" class="text-danger"></span>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="form-group col-md-5">
                        <label asp-for="Proviene" class="control-label">Institución de donde proviene el estudiante</label>
                        <input asp-for="Proviene" class="form-control" />
                        <span asp-validation-for="Proviene" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="Beca" class="control-label">Beca</label>
                        <select asp-for="Beca" class="form-control">
                            <option value="SIN BECA">SIN BECA</option>
                            <option value="MEDIA BECA">MEDIA BECA</option>
                            <option value="BECA COMPLETA">BECA COMPLETA</option>
                        </select>
                        <span asp-validation-for="Beca" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="RepiteAño" class="control-label">Repitente</label>
                        <select asp-for="RepiteAño" class="form-control">
                            <option value="NO">NO</option>
                            <option value="SI">SI</option>
                        </select>
                        <span asp-validation-for="RepiteAño" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-3">
                        <label asp-for="EstadoIngreso" class="control-label">Estado de Ingreso</label>
                        <select asp-for="EstadoIngreso" class="form-control">
                            <option value="REINGRESO">REINGRESO</option>
                            <option value="PRIMER INGRESO">PRIMER INGRESO</option>
                        </select>
                        <span asp-validation-for="EstadoIngreso" class="text-danger"></span>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="form-group col-md-4">
                        <label asp-for="Observacion" class="control-label">Observación</label>
                        <input asp-for="Observacion" class="form-control" />
                        <span asp-validation-for="Observacion" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="FechaIngreso" class="control-label">Fecha de Ingreso</label>
                        <input type="date" asp-for="FechaIngreso" class="form-control" />
                        <span asp-validation-for="FechaIngreso" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="Sistema" class="control-label">Sistema</label>
                        <select asp-for="Sistema" id="Sistema" class="form-control">
                            <option value="ANGLOSAJÓN">ANGLOSAJÓN</option>
                            <option value="TRADICIONAL">TRADICIONAL</option>
                        </select>
                        <span asp-validation-for="Sistema" class="text-danger"></span>
                    </div>
                    <div class="form-group col-md-2">
                        <label asp-for="SistemaTiempo" class="control-label">Sistema (Periodo)</label>
                        <input asp-for="SistemaTiempo" id="SistemaTiempo" readonly class="form-control" />
                        <span asp-validation-for="SistemaTiempo" class="text-danger"></span>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="form-group col-md-4">
                        <label class="control-label">Fotografía</label>
                        <input type="file" name="fotoInput" class="form-control" id="fotoInput" accept="image/*" />
                        <img id="previewFoto" src="#" alt="Vista previa de la foto" style="max-width: 200px; max-height: 200px; display: none;" class="mt-2" />
                        <span asp-validation-for="FotoData" class="text-danger"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-group text-center mt-4">
            <button type="button" id="btnMatricular" class="btn btn-primary btn-lg">Matricular</button>
            <a class="btn btn-warning btn-lg ml-2" asp-action="Index">Regresar a la Lista</a>
        </div>
    </form>
</div>

@* TOASTR DE BOOSTRAP *@
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="liveToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto">Notificación</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            La identidad no está registrada. Puede continuar con la matrícula.
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    @* FUNCION para MOSTRAR FOTO PREVIEW *@
    <script>
        document.getElementById('fotoInput').onchange = function (evt) {
            var tgt = evt.target || window.event.srcElement,
                files = tgt.files;

            if (FileReader && files && files.length) {
                var fr = new FileReader();
                fr.onload = function () {
                    document.getElementById('previewFoto').src = fr.result;
                    document.getElementById('previewFoto').style.display = 'block';
                }
                fr.readAsDataURL(files[0]);
            }
        }
    </script>
    
    @* FUNCION para CARGAR DATOS AUTOMATICAMENTE / AUTORELLENER DATOS DEL PADRE *@
    <script>
        $(document).ready(function () {
            $('#Idpadre').on('keydown', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    buscarPadre();
                }
            });

            function buscarPadre() {
                var idpadre = $('#Idpadre').val();
                
                $.get('@Url.Action("GetPadreInfo", "Matricula")', { idpadre: idpadre })
                    .done(function (result) {
                        if (result.success) {
                            $('#NombrePadre').val(result.nombrePadre);
                            $('#Parentesco').val(result.parentesco);
                            $('#TelefonoPadre').val(result.telefonoPadre);
                            $('#CelPadre').val(result.celPadre);
                            $('#DireccionPadre').val(result.direccionPadre);
                        } else {
                            mostrarAlerta('No se encontró ningún padre registrado con esa identidad.', 'error');
                        }
                    })
                    .fail(function () {
                        mostrarAlerta('Ocurrió un error al buscar la información del padre.', 'error');
                    });
            }

            function mostrarAlerta(mensaje, tipo) {
                Swal.fire({
                    title: 'Atención',
                    text: mensaje,
                    icon: tipo,
                    timer: 2000,
                    timerProgressBar: true,
                    showConfirmButton: false
                });
            }
        });
    </script>  

    @* FUNCION PARA QUE CUANDO SELECCIONE EL ID AÑO, SE AUTORELLENEN LOS ID GRADOS EN EL SELECT *@
    <script>
        $(document).ready(function () {
            $('#Idaño').change(function () {
                var idAnio = $(this).val();
                if (idAnio) {
                    $.get('@Url.Action("GetGradosPorAnio", "Matricula")', { idAnio: idAnio })
                        .done(function (grados) {
                            var selectGrado = $('#Idgrado');
                            selectGrado.empty();
                            selectGrado.append($('<option></option>').val('').text('Seleccione un grado'));
                            $.each(grados, function (index, grado) {
                                selectGrado.append($('<option></option>').val(grado.idgrado).text(grado.idgrado));
                            });
                        })
                        .fail(function () {
                            mostrarAlerta('Error al cargar los grados', 'error');
                        });
                } else {
                    $('#Idgrado').empty().append($('<option></option>').val('').text('Seleccione un grado'));
                }
            });

            function mostrarAlerta(mensaje, tipo) {
                Swal.fire({
                    title: 'Atención',
                    text: mensaje,
                    icon: tipo,
                    timer: 3000,
                    timerProgressBar: true,
                    showConfirmButton: false
                });
            }
        });
    </script>

    @* FUNCION PARA AUTORELLENER LOS DEMAS DATOS AL SELECCIONAR EL ID GRADO *@
    <script>
        $(document).ready(function () {
            // Evento change para el select de Idgrado
            $('#Idgrado').change(function () {
                var idGrado = $(this).val();
                if (idGrado) {
                    $.get('@Url.Action("GetDetallesGrado", "Matricula")', { idGrado: idGrado })
                        .done(function (detalles) {
                            if (detalles) {
                                $('#Grado').val(detalles.grado1);
                                $('#Seccion').val(detalles.seccion);
                                $('#Jornada').val(detalles.jornada);
                                $('#NivelDescripcion').val(detalles.nivelDescripcion);
                            } else {
                                limpiarCampos();
                            }
                        })
                        .fail(function () {
                            mostrarAlerta('Error al cargar los detalles del grado', 'error');
                            limpiarCampos();
                        });
                } else {
                    limpiarCampos();
                }
            });

            function limpiarCampos() {
                $('#Grado').val('');
                $('#Seccion').val('');
                $('#Jornada').val('');
                $('#NivelDescripcion').val('');
            }

            function mostrarAlerta(mensaje, tipo) {
                Swal.fire({
                    title: 'Atención',
                    text: mensaje,
                    icon: tipo,
                    timer: 3000,
                    timerProgressBar: true,
                    showConfirmButton: false
                });
            }
        });
    </script>

    @* FUNCION PARA SELECCIONAR EL TIPO DE SISTEMA SI ES ANGLOSAJÓN O INTERNACIONAL  *@
    <script>
        $(document).ready(function () {
            // Función para actualizar el SistemaTiempo
            function actualizarSistemaTiempo() {
                var sistema = $('#Sistema').val();
                var idAnio = $('#Idaño').val();

                if (sistema === 'ANGLOSAJÓN') {
                    var anioSiguiente = parseInt(idAnio) + 1;
                    $('#SistemaTiempo').val(idAnio + '-' + anioSiguiente);
                } else if (sistema === 'TRADICIONAL') {
                    $('#SistemaTiempo').val(idAnio);
                }
            }

            // Evento change para el select de Sistema
            $('#Sistema').change(function () {
                actualizarSistemaTiempo();
            });

            // Evento change para el select de Idaño
            $('#Idaño').change(function () {
                actualizarSistemaTiempo();
            });

            // Llamar a la función al cargar la página por si hay valores preseleccionados
            actualizarSistemaTiempo();
        });
    </script>

    @* FUNCION PARA CALCULAR LA EDAD *@
    <script>
        $(document).ready(function () {
            // Función para calcular la edad
            function calcularEdad() {
                var fechaNacimiento = new Date($('#FechaNacimiento').val());
                var hoy = new Date();
                var edad = hoy.getFullYear() - fechaNacimiento.getFullYear();
                var m = hoy.getMonth() - fechaNacimiento.getMonth();

                if (m < 0 || (m === 0 && hoy.getDate() < fechaNacimiento.getDate())) {
                    edad--;
                }

                $('#Edad').val(edad);
            }

            // Evento change para el input de Fecha de Nacimiento
            $('#FechaNacimiento').change(function () {
                calcularEdad();
            });

            // Calcular la edad al cargar la página si ya hay una fecha seleccionada
            if ($('#FechaNacimiento').val()) {
                calcularEdad();
            }
        });
    </script>
    @* VALIADACIÓN DE QUE LA IDENTIDAD DEL ESTUDIANTE NO EXISTA *@
    <script>
        function buscarEstudiante(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                var ididentidad = document.getElementById('Ididentidad').value;
                
                fetch(`/Matricula/BuscarEstudiante?ididentidad=${ididentidad}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.estudianteRegistrado) {
                            // Mostrar SweetAlert2
                            Swal.fire({
                                title: 'Estudiante Registrado',
                                text: 'El estudiante ya está registrado en años anteriores.',
                                icon: 'info',
                                timer: 3000,
                                showConfirmButton: false
                            });

                            // Rellenar los campos con los datos del estudiante
                            document.getElementById('NombreEstudiante').value = data.nombreEstudiante;
                            document.getElementById('Nacionalidad').value = data.nacionalidad;
                            document.getElementById('FechaNacimiento').value = data.fechaNacimiento;
                            document.getElementById('LugarNacimiento').value = data.lugarNacimiento;
                            document.getElementById('Genero').value = data.genero;
                            document.getElementById('TipoSangre').value = data.tipoSangre;
                            document.getElementById('Alergia').value = data.alergia;
                            document.getElementById('Edad').value = data.edad;
                            document.getElementById('TelefonoEstudiante').value = data.telefonoEstudiante;
                            document.getElementById('CelularEstudiante').value = data.celularEstudiante;
                            document.getElementById('Correo').value = data.correo;
                            document.getElementById('Direccion').value = data.direccion;
                            document.getElementById('Estado').value = data.estado;
                            document.getElementById('VacunasCovid').value = data.vacunasCovid;

                            // Datos académicos
                            document.getElementById('Idgrado').value = data.idgrado;
                            document.getElementById('Grado').value = data.grado;
                            document.getElementById('Seccion').value = data.seccion;
                            document.getElementById('Jornada').value = data.jornada;
                            document.getElementById('NivelDescripcion').value = data.nivelDescripcion;
                            document.getElementById('Proviene').value = data.proviene;
                            document.getElementById('Beca').value = data.beca;
                            document.getElementById('RepiteAño').value = data.repiteAño;
                            document.getElementById('Observacion').value = data.observacion;
                            document.getElementById('EstadoIngreso').value = data.estadoIngreso;
                            document.getElementById('FechaIngreso').value = data.fechaIngreso;
                            document.getElementById('Sistema').value = data.sistema;
                            document.getElementById('SistemaTiempo').value = data.sistemaTiempo;

                            // Datos del padre
                            document.getElementById('Idpadre').value = data.idpadre;
                            document.getElementById('NombrePadre').value = data.nombrePadre;
                            document.getElementById('Parentesco').value = data.parentesco;
                            document.getElementById('TelefonoPadre').value = data.telefonoPadre;
                            document.getElementById('CelPadre').value = data.celPadre;
                            document.getElementById('DireccionPadre').value = data.direccionPadre;
                        } else {
                            // Mostrar el toast
                            var toastLiveExample = document.getElementById('liveToast')
                            var toast = new bootstrap.Toast(toastLiveExample)
                            toast.show()
                            
                            // Enfocar el siguiente campo
                            document.getElementById('NombreEstudiante').focus();
                        }
                    });
            }
        }
    </script>

    @* SCRIPT PARA QUE EN SISTEMA PERIODO DE TIEMPO *@
    <script>
        $(document).ready(function () {
            // Función para actualizar el campo "Sistema (Periodo)"
            function actualizarSistemaTiempo() {
                var sistema = $('#Sistema').val(); // Obtener el valor del sistema seleccionado
                var idAnio = $('#Idaño').val(); // Obtener el valor del año seleccionado

                if (sistema === 'ANGLOSAJÓN') {
                    // Si el sistema es ANGLOSAJÓN, concatenar el año actual y el siguiente
                    var anioSiguiente = parseInt(idAnio) + 1;
                    $('#SistemaTiempo').val(idAnio + '-' + anioSiguiente);
                } else if (sistema === 'TRADICIONAL') {
                    // Si el sistema es TRADICIONAL, usar solo el año actual
                    $('#SistemaTiempo').val(idAnio);
                }
            }

            // Evento change para el select de Sistema
            $('#Sistema').change(function () {
                actualizarSistemaTiempo();
            });

            // Evento change para el select de Idaño
            $('#Idaño').change(function () {
                actualizarSistemaTiempo();
            });

            // Llamar a la función al cargar la página por si hay valores preseleccionados
            actualizarSistemaTiempo();
        });
    </script>

    @* ALTERTA DE SI SE MATRICULO O NO EL ESTUDIANTE  *@
    <script>
        $(document).ready(function () {
            // Manejar el clic en el botón "Matricular"
            $('#btnMatricular').click(function () {
                // Obtener el nombre del estudiante y el grado desde el formulario
                var nombreEstudiante = $('#NombreEstudiante').val();
                var grado = $('#Grado').val();
                var sistematiempo = $('#SistemaTiempo').val();

                // Mostrar SweetAlert2 con el mensaje de éxito
                Swal.fire({
                    icon: 'success',
                    title: '¡Matrícula Exitosa!',
                    html: `El estudiante <strong>${nombreEstudiante}</strong> ha sido matriculado(a) en el grado <strong>${grado}</strong> del periodo escolar <strong>${sistematiempo}</strong>.`,
                    confirmButtonText: 'Aceptar'
                }).then(() => {
                    // Enviar el formulario manualmente
                    $('form').submit();
                });
            });

            // Mostrar mensaje de éxito si existe (después de redirigir)
            @if (TempData["SuccessMessage"] != null)
            {
                <text>
                Swal.fire({
                    icon: 'success',
                    title: '¡Éxito!',
                    text: '@TempData["SuccessMessage"]',
                    confirmButtonText: 'Aceptar'
                });
                </text>
            }
        });
    </script>
}
