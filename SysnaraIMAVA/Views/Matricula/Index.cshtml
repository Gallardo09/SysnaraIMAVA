@model IEnumerable<SysnaraIMAVA.Models.Matricula>
@{
    ViewData["Title"] = "Matrícula Estudiantil";
    var años = ViewBag.Años as List<SysnaraIMAVA.Models.Año>;
}

<div class="matricula-container">
    <div class="matricula-header">
        <h1 class="matricula-title">Matrícula Estudiantil</h1>
    </div>
    <div class="matricula-filters">
        <div class="filter-group">
            <label for="filtroAño">Año</label>
            <select class="form-select" id="filtroAño">
                <option value="">Seleccione un año</option>
                @if (años != null)
                {
                    @foreach (var año in años)
                    {
                        <option value="@año.Idaño">@año.Idaño</option>
                    }
                }
            </select>
        </div>
        <div class="filter-group">
            <label for="filtroGrado">Grado</label>
            <select class="form-select" id="filtroGrado">
                <option value="">Seleccione un grado</option>
            </select>
        </div>
        <div class="filter-group">
            <label>&nbsp;</label>
            <a class="btn btn-primary form-control" asp-action="Create">Matricular Nuevo</a>
        </div>
    </div>
</div>

<table id="matriculasTable" class="table table-striped table-hover" style="width:100%; font-size: 13px;">
    <thead>
        <tr>
            <th>ID IMV</th>
            <th>DNI</th>
            <th>Nacionalidad</th>
            <th>Nombre del Estudiante</th>
            <th>Fecha de Nacimiento</th>
            <th>Genero</th>
            <th>Estado</th>
            <th>Grado</th>
            <th>Estado Ingreso</th>
            <th>Editar</th>
            <th>Detalles</th>
            <th>Eliminar</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

@section Scripts {
    <script>
        $(document).ready(function () {
            var table = $('#matriculasTable').DataTable({
                columns: [
                    { data: 'idimv' },
                    { data: 'idestudiante' },
                    { data: 'nacionalidad' },
                    { data: 'nombreEstudiante' },
                    { data: 'fechaNacimiento' },
                    { data: 'genero' },
                    { data: 'estado' },
                    { data: 'grado' },
                    { data: 'estadoIngreso' },
                    {
                        data: 'idest',
                        render: function (data) {
                            return '<a class="btn btn-primary btn-sm action-btn" href="/Matricula/Edit/' + data + '"><i class="fas fa-edit"></i> Editar</a>';
                        }
                    },
                    {
                        data: 'idest',
                        render: function (data) {
                            return '<a class="btn btn-info btn-sm action-btn" href="/Matricula/Details/' + data + '"><i class="fas fa-info-circle"></i> Detalles</a>';
                        }
                    },
                    {
                        data: 'idest',
                        render: function (data) {
                            return '<a class="btn btn-danger btn-sm action-btn" href="/Matricula/Delete/' + data + '"><i class="fas fa-trash-alt"></i> Eliminar</a>';
                        }
                    }
                ],
                order: [[5, 'asc'], [3, 'asc']]
            });

            function cargarMatriculas() {
                var idAño = $('#filtroAño').val();
                var idGrado = $('#filtroGrado').val();

                if (idAño) {
                    $.ajax({
                        url: '/Matricula/GetMatriculas',
                        data: { idAño: idAño, idGrado: idGrado },
                        success: function (data) {
                            table.clear().rows.add(data).draw();
                        }
                    });
                } else {
                    table.clear().draw();
                }
            }

            $('#filtroAño').change(function () {
                var idAño = $(this).val();
                $('#filtroGrado').empty().append('<option value="">Seleccione un grado</option>');
                if (idAño) {
                    $.ajax({
                        url: '/Matricula/GetGrados',
                        data: { idAño: idAño },
                        success: function (data) {
                            $.each(data, function (index, item) {
                                $('#filtroGrado').append($('<option>', {
                                    value: item.idgrado,
                                    text: item.gradoCompleto
                                }));
                            });
                        }
                    });
                }
                cargarMatriculas();
            });

            $('#filtroGrado').change(cargarMatriculas);
        });
    </script>
}

<style>
    .matricula-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem;
        background-color: #f8f9fa;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .matricula-header {
        text-align: center;
        margin-bottom: 1rem;
    }

    .matricula-title {
        font-family: 'Russo One', sans-serif;
        color: #007bff;
        font-size: 2rem;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .matricula-filters {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .filter-group {
        flex: 1;
    }

        .filter-group label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: bold;
            color: #495057;
        }

    .form-select, .btn {
        width: 100%;
        padding: 0.375rem 0.75rem;
        font-size: 0.9rem;
    }

    .action-btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        line-height: 1.5;
        white-space: nowrap;
        width: auto;
    }

        .action-btn i {
            margin-right: 0.25rem;
        }

    #matriculasTable td {
        vertical-align: middle;
    }

    @@media (max-width: 768px) {
        .matricula-filters {
            flex-direction: column;
        }

        .filter-group {
            width: 100%;
        }
    }
</style>