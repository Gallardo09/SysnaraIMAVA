@model IEnumerable<SysnaraIMAVA.Models.Asignatura>

@{
    ViewData["Title"] = "Asignaturas";
    var años = ViewBag.Años as List<SysnaraIMAVA.Models.Año>;
}

<div class="container mt-1" style="margin-bottom: 0px; margin-top: 0px; padding-bottom: 0px; padding-top: 0px;">
    <div class="row justify-content-center">
        <div class="col-md-8 text-center">
            <h2 class="text-primary mb-3" style="font-family: Russo One, sans-serif;">Registrar Asignatura</h2>
        </div>
    </div>
</div>

<div class="container mt-0" style="margin-bottom: 0px; margin-top: 0px; padding-bottom: 0px; padding-top: 0px;">
    <div class="card shadow-sm border-light">
        <div class="card-body">
            <div class="row justify-content-center">
                <div class="col-md-3 mb-2">
                    <label for="filtroAño" class="form-label">Año</label>
                    <select class="form-select" id="filtroAño">
                        <option value="">Seleccione un año</option>
                        @if (años != null)
                        {
                            @foreach (var año in años)
                            {
                                <option value="@año.Idaño">@año.Idaño</option>
                            }
                        }
                    </select>
                </div>

                <div class="col-md-2 mb-2 d-flex align-items-end">
                    <a href="/Asignaturas/Create" class="btn btn-outline-primary w-100">
                        <i class="fas fa-plus-circle"></i> Registrar
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<br />

<table id="example" class="table table-striped table-hover" style="width:100%; font-size: 13px;">
    <thead>
        <tr>
            <th>ID Asignatura</th>
            <th>Nombre</th>
            <th>ID Grado</th>
            <th>Grado</th>
            <th>Sección</th>
            <th>Jornada</th>
            <th>Periodo</th>
            <th>Año</th>
            <th>Editar</th>
            <th>Detalles</th>
            <th>Eliminar</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

@section Scripts {
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <script src="https://cdn.datatables.net/2.2.1/css/dataTables.dataTables.css"></script>
    <script>
        $(document).ready(function () {
            if ($.fn.DataTable.isDataTable('#example')) {
                $('#example').DataTable().destroy();
            }

            var table = $('#example').DataTable({
                columns: [
                    { data: 'idasignatura' },
                    { data: 'asignatura' },
                    { data: 'idgrado' },
                    { data: 'grado' },
                    { data: 'seccion' },
                    { data: 'jornada' },
                    { data: 'periodo' },
                    { data: 'anio' },
                    {
                        data: 'idasignatura',
                        render: function (data) {
                            return '<a class="btn btn-warning" href="/Asignaturas/Edit/' + data + '">Editar</a>';
                        }
                    },
                    {
                        data: 'idasignatura',
                        render: function (data) {
                            return '<a class="btn btn-primary" href="/Asignaturas/Details/' + data + '">Detalles</a>';
                        }
                    },
                    {
                        data: 'idasignatura',
                        render: function (data) {
                            return '<a class="btn btn-danger" href="/Asignaturas/Delete/' + data + '">Eliminar</a>';
                        }
                    }
                ]
            });

            function cargarAsignaturas() {
                var idAño = $('#filtroAño').val();

                if (idAño) {
                    $.ajax({
                        url: '/Asignaturas/GetAsignaturas',
                        type: 'GET',
                        data: {
                            idAño: idAño
                        },
                        success: function (data) {
                            table.clear().rows.add(data).draw();
                        },
                        error: function (xhr, status, error) {
                            console.error('Error cargando asignaturas:', status, error);
                        }
                    });
                } else {
                    table.clear().draw();
                }
            }

            $('#filtroAño').change(function() {
                cargarAsignaturas();
            });

            cargarAsignaturas();
        });
    </script>
}